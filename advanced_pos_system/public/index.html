<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced POS System with Vision AI</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-dark: #4338ca;
            --primary-light: #818cf8;
            --secondary-color: #10b981;
            --secondary-dark: #059669;
            --secondary-light: #34d399;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --gray-color: #6b7280;
        }

        [data-theme="dark"] {
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --text-primary: #f9fafb;
            --text-secondary: #e5e7eb;
            --border-color: #374151;
        }

        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --border-color: #e5e7eb;
        }

        body {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        .bg-primary {
            background-color: var(--bg-primary);
        }

        .border-color {
            border-color: var(--border-color);
        }

        .text-color {
            color: var(--text-primary);
        }

        .text-secondary {
            color: var(--text-secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .camera-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .recognition-box {
            position: absolute;
            border: 2px solid var(--secondary-color);
            background-color: rgba(16, 185, 129, 0.2);
        }

        .recognition-label {
            position: absolute;
            background-color: var(--secondary-color);
            color: white;
            padding: 2px 6px;
            font-size: 12px;
            border-radius: 4px;
        }

        .receipt-item {
            border-bottom: 1px solid var(--border-color);
        }

        .receipt-item:last-child {
            border-bottom: none;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-outline {
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            background-color: var(--border-color);
        }

        .toast {
            max-width: 350px;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="flex flex-col h-screen">
        <!-- Header -->
        <header class="bg-primary border-b border-color shadow-sm">
            <div class="container mx-auto px-4 py-3">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <h1 class="text-xl font-bold text-color">Advanced POS System</h1>
                        <span class="ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded dark:bg-blue-900 dark:text-blue-200">Vision AI</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="syncBtn" class="text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200" aria-label="Sync data">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button id="themeToggleBtn" class="text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200" aria-label="Toggle theme">
                            <i class="fas fa-moon dark:hidden"></i>
                            <i class="fas fa-sun hidden dark:block"></i>
                        </button>
                        <div class="relative">
                            <button id="userMenuBtn" class="flex items-center text-sm font-medium text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100">
                                <span class="mr-2">John Doe</span>
                                <img class="h-8 w-8 rounded-full" src="https://ui-avatars.com/api/?name=John+Doe&background=random" alt="User avatar">
                            </button>
                            <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-10">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700">Profile</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700">Settings</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 flex overflow-hidden">
            <!-- Left Sidebar - Product Scanner -->
            <div class="w-full md:w-2/3 lg:w-3/5 flex flex-col bg-primary border-r border-color">
                <div class="p-4">
                    <h2 class="text-lg font-semibold text-color mb-4">Product Scanner</h2>
                    
                    <!-- Camera View -->
                    <div class="camera-container mb-4 bg-gray-900 rounded-lg overflow-hidden">
                        <video id="cameraVideo" class="w-full" autoplay playsinline></video>
                        <canvas id="cameraCanvas" class="camera-overlay"></canvas>
                    </div>
                    
                    <!-- Camera Controls -->
                    <div class="flex justify-between mb-4">
                        <div>
                            <button id="captureBtn" class="btn-primary px-4 py-2 rounded-md">
                                <i class="fas fa-camera mr-2"></i> Capture
                            </button>
                            <button id="autoCaptureBtn" class="btn-outline ml-2 px-4 py-2 rounded-md">
                                <i class="fas fa-sync mr-2"></i> Auto Capture
                            </button>
                        </div>
                        <div>
                            <button id="switchCameraBtn" class="btn-outline px-4 py-2 rounded-md">
                                <i class="fas fa-sync-alt mr-2"></i> Switch Camera
                            </button>
                        </div>
                    </div>
                    
                    <!-- Recognition Results -->
                    <div id="recognitionResults" class="bg-primary border border-color rounded-lg p-4 mb-4">
                        <h3 class="text-md font-semibold text-color mb-2">Recognition Results</h3>
                        <div id="resultsContent" class="text-secondary">
                            <p class="text-center py-4">No products recognized yet</p>
                        </div>
                    </div>
                    
                    <!-- Product Search -->
                    <div class="mb-4">
                        <div class="relative">
                            <input type="text" id="productSearch" class="w-full px-4 py-2 border border-color rounded-md bg-primary text-color" placeholder="Search products...">
                            <button class="absolute right-2 top-2 text-gray-500">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Product Categories -->
                    <div class="flex overflow-x-auto space-x-2 pb-2 mb-4">
                        <button class="btn-primary whitespace-nowrap px-4 py-2 rounded-md">All</button>
                        <button class="btn-outline whitespace-nowrap px-4 py-2 rounded-md">Beverages</button>
                        <button class="btn-outline whitespace-nowrap px-4 py-2 rounded-md">Snacks</button>
                        <button class="btn-outline whitespace-nowrap px-4 py-2 rounded-md">Dairy</button>
                        <button class="btn-outline whitespace-nowrap px-4 py-2 rounded-md">Bakery</button>
                        <button class="btn-outline whitespace-nowrap px-4 py-2 rounded-md">Produce</button>
                    </div>
                    
                    <!-- Product Grid -->
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Product items will be dynamically added here -->
                        <div class="bg-primary border border-color rounded-lg overflow-hidden">
                            <div class="h-32 bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                                <i class="fas fa-image text-4xl text-gray-400"></i>
                            </div>
                            <div class="p-3">
                                <h4 class="font-medium text-color">Cola Drink 330ml</h4>
                                <div class="flex justify-between items-center mt-2">
                                    <span class="text-secondary">$1.99</span>
                                    <button class="btn-primary p-1 rounded-md" aria-label="Add to cart">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-primary border border-color rounded-lg overflow-hidden">
                            <div class="h-32 bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                                <i class="fas fa-image text-4xl text-gray-400"></i>
                            </div>
                            <div class="p-3">
                                <h4 class="font-medium text-color">Potato Chips 150g</h4>
                                <div class="flex justify-between items-center mt-2">
                                    <span class="text-secondary">$2.49</span>
                                    <button class="btn-primary p-1 rounded-md" aria-label="Add to cart">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-primary border border-color rounded-lg overflow-hidden">
                            <div class="h-32 bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                                <i class="fas fa-image text-4xl text-gray-400"></i>
                            </div>
                            <div class="p-3">
                                <h4 class="font-medium text-color">Chocolate Bar 100g</h4>
                                <div class="flex justify-between items-center mt-2">
                                    <span class="text-secondary">$1.79</span>
                                    <button class="btn-primary p-1 rounded-md" aria-label="Add to cart">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Sidebar - Cart -->
            <div class="hidden md:flex md:w-1/3 lg:w-2/5 flex-col bg-primary">
                <div class="p-4 flex-1 flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold text-color">Shopping Cart</h2>
                        <div>
                            <span id="currentDate" class="text-sm text-secondary"></span>
                        </div>
                    </div>
                    
                    <!-- Receipt -->
                    <div class="flex-1 flex flex-col bg-primary border border-color rounded-lg overflow-hidden mb-4">
                        <div class="p-3 border-b border-color">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-color">Receipt #<span id="receiptNumber">1001</span></span>
                                <button id="clearCartBtn" class="text-sm text-red-500 hover:text-red-700">
                                    Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div id="receiptItems" class="flex-1 overflow-y-auto p-2">
                            <!-- Cart items will be dynamically added here -->
                            <div class="text-center py-8 text-secondary">
                                <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                                <p>No items in cart</p>
                            </div>
                        </div>
                        
                        <div class="p-3 border-t border-color">
                            <div class="flex justify-between py-1">
                                <span class="text-secondary">Subtotal</span>
                                <span id="subtotal" class="text-color">$0.00</span>
                            </div>
                            <div class="flex justify-between py-1">
                                <span class="text-secondary">Tax</span>
                                <span id="tax" class="text-color">$0.00</span>
                            </div>
                            <div class="flex justify-between py-1">
                                <span class="text-secondary">Discount</span>
                                <span id="discount" class="text-color">$0.00</span>
                            </div>
                            <div class="flex justify-between py-2 font-bold">
                                <span class="text-color">Total</span>
                                <span id="total" class="text-color">$0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Checkout Button -->
                    <button id="checkoutBtn" class="btn-secondary py-3 rounded-lg font-medium">
                        <i class="fas fa-cash-register mr-2"></i> Checkout
                    </button>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-primary border-t border-color py-2">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center">
                    <div class="text-sm text-secondary">
                        &copy; 2025 Advanced POS System
                    </div>
                    <div class="text-sm text-secondary">
                        Version 1.0.0
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <!-- Checkout Modal -->
    <div id="checkoutModal" class="fixed inset-0 flex items-center justify-center z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="checkoutModalTitle">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full mx-4">
            <div class="p-6">
                <h3 id="checkoutModalTitle" class="text-lg font-medium text-gray-900 dark:text-white mb-4">Complete Payment</h3>
                
                <div class="mb-6">
                    <div class="flex justify-between py-2">
                        <span class="text-gray-600 dark:text-gray-400">Total Amount</span>
                        <span id="checkoutTotal" class="font-bold">$0.00</span>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Payment Method</label>
                        <div class="flex space-x-2 mb-4">
                            <button class="payment-method-btn btn-primary px-4 py-2 rounded-md" data-method="cash">Cash</button>
                            <button class="payment-method-btn btn-outline px-4 py-2 rounded-md" data-method="card">Card</button>
                            <button class="payment-method-btn btn-outline px-4 py-2 rounded-md" data-method="mobile">Mobile</button>
                        </div>
                        
                        <div id="cashPaymentForm">
                            <div class="mb-4">
                                <label for="amountTendered" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount Tendered</label>
                                <input type="number" id="amountTendered" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Change</label>
                                <div id="changeAmount" class="text-lg font-bold">$0.00</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-2">
                    <button id="cancelCheckoutBtn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded hover:bg-gray-300 dark:hover:bg-gray-600">
                        Cancel
                    </button>
                    <button id="completePaymentBtn" class="btn-secondary px-4 py-2 rounded-md">
                        Complete Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Complete Modal -->
    <div id="paymentCompleteModal" class="fixed inset-0 flex items-center justify-center z-50 hidden" role="dialog" aria-modal="true">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full mx-4">
            <div class="p-6 text-center">
                <div class="w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-2xl text-green-600 dark:text-green-400"></i>
                </div>
                
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Payment Complete</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6">Transaction has been successfully processed.</p>
                
                <div class="flex justify-center space-x-2">
                    <button id="printReceiptBtn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded hover:bg-gray-300 dark:hover:bg-gray-600">
                        <i class="fas fa-print mr-2"></i> Print Receipt
                    </button>
                    <button id="newSaleBtn" class="btn-primary px-4 py-2 rounded-md">
                        New Sale
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="fixed inset-0 flex items-center justify-center z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="addProductModalTitle">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-lg w-full mx-4">
            <div class="p-6">
                <h3 id="addProductModalTitle" class="text-lg font-medium text-gray-900 dark:text-white mb-4">Add New Product</h3>
                
                <form id="addProductForm">
                    <div class="mb-4">
                        <label for="productName" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Product Name</label>
                        <input type="text" id="productName" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="productPrice" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Price</label>
                            <input type="number" id="productPrice" step="0.01" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
                        </div>
                        <div>
                            <label for="productCategory" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                            <select id="productCategory" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="beverages">Beverages</option>
                                <option value="snacks">Snacks</option>
                                <option value="dairy">Dairy</option>
                                <option value="bakery">Bakery</option>
                                <option value="produce">Produce</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="productSKU" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SKU</label>
                            <input type="text" id="productSKU" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        </div>
                        <div>
                            <label for="initialStock" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Initial Stock</label>
                            <input type="number" id="initialStock" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white" value="0">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Product Images</label>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Take multiple photos of the product for Vision AI training</p>
                        
                        <div class="flex space-x-2 mb-2">
                            <button type="button" id="captureProductImageBtn" class="btn-primary px-4 py-2 rounded-md">
                                <i class="fas fa-camera mr-2"></i> Capture
                            </button>
                            <button type="button" id="uploadImagesBtn" class="btn-outline px-4 py-2 rounded-md">
                                <i class="fas fa-upload mr-2"></i> Upload
                            </button>
                            <input type="file" id="productImages" class="hidden" accept="image/*" multiple>
                        </div>
                        
                        <div id="imagePreviewContainer" class="hidden grid grid-cols-3 gap-2 mt-2">
                            <!-- Image previews will be added here -->
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="cancelAddProductBtn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded hover:bg-gray-300 dark:hover:bg-gray-600">
                            Cancel
                        </button>
                        <button type="submit" class="btn-secondary px-4 py-2 rounded-md">
                            Save Product
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/aws.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // Initialize app when document is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            const currentDateElement = document.getElementById('currentDate');
            if (currentDateElement) {
                const now = new Date();
                currentDateElement.textContent = now.toLocaleDateString();
            }
            
            // Initialize theme
            const prefersDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.documentElement.setAttribute('data-theme', prefersDarkMode ? 'dark' : 'light');
            
            // Theme toggle
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            if (themeToggleBtn) {
                themeToggleBtn.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                    document.documentElement.setAttribute('data-theme', newTheme);
                });
            }
            
            // User menu toggle
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userMenu = document.getElementById('userMenu');
            if (userMenuBtn && userMenu) {
                userMenuBtn.addEventListener('click', function() {
                    userMenu.classList.toggle('hidden');
                });
                
                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    if (!userMenuBtn.contains(event.target) && !userMenu.contains(event.target)) {
                        userMenu.classList.add('hidden');
                    }
                });
            }
            
            // Initialize camera
            const cameraVideo = document.getElementById('cameraVideo');
            const cameraCanvas = document.getElementById('cameraCanvas');
            const captureBtn = document.getElementById('captureBtn');
            
            if (cameraVideo && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(function(stream) {
                        cameraVideo.srcObject = stream;
                        cameraVideo.play();
                    })
                    .catch(function(error) {
                        console.error('Error accessing camera:', error);
                        // Show error message
                        const recognitionResults = document.getElementById('recognitionResults');
                        if (recognitionResults) {
                            recognitionResults.innerHTML = `
                                <h3 class="text-md font-semibold text-color mb-2">Camera Error</h3>
                                <div class="text-secondary">
                                    <p class="text-center py-4 text-red-500">Failed to access camera: ${error.message}</p>
                                </div>
                            `;
                        }
                    });
            }
            
            // Capture button
            if (captureBtn && cameraVideo && cameraCanvas) {
                captureBtn.addEventListener('click', function() {
                    // Set canvas dimensions to match video
                    cameraCanvas.width = cameraVideo.videoWidth;
                    cameraCanvas.height = cameraVideo.videoHeight;
                    
                    // Draw video frame to canvas
                    const context = cameraCanvas.getContext('2d');
                    context.drawImage(cameraVideo, 0, 0, cameraCanvas.width, cameraCanvas.height);
                    
                    // Simulate recognition
                    simulateRecognition();
                });
            }
            
            // Auto capture toggle
            const autoCaptureBtn = document.getElementById('autoCaptureBtn');
            let autoCaptureInterval = null;
            
            if (autoCaptureBtn) {
                autoCaptureBtn.addEventListener('click', function() {
                    if (autoCaptureInterval) {
                        // Stop auto capture
                        clearInterval(autoCaptureInterval);
                        autoCaptureInterval = null;
                        autoCaptureBtn.innerHTML = '<i class="fas fa-sync mr-2"></i> Auto Capture';
                        autoCaptureBtn.classList.remove('btn-secondary');
                        autoCaptureBtn.classList.add('btn-outline');
                        
                        // Show toast
                        showToast('Auto capture disabled', 'info');
                    } else {
                        // Start auto capture
                        autoCaptureBtn.innerHTML = '<i class="fas fa-stop mr-2"></i> Stop Auto';
                        autoCaptureBtn.classList.remove('btn-outline');
                        autoCaptureBtn.classList.add('btn-secondary');
                        
                        // Show toast
                        showToast('Auto capture enabled - scanning every 3 seconds', 'info');
                        
                        // Trigger capture immediately
                        if (captureBtn) captureBtn.click();
                        
                        // Set interval
                        autoCaptureInterval = setInterval(function() {
                            if (captureBtn) captureBtn.click();
                        }, 3000);
                    }
                });
            }
            
            // Switch camera button
            const switchCameraBtn = document.getElementById('switchCameraBtn');
            let frontCamera = false;
            
            if (switchCameraBtn && cameraVideo) {
                switchCameraBtn.addEventListener('click', function() {
                    if (cameraVideo.srcObject) {
                        // Stop current stream
                        cameraVideo.srcObject.getTracks().forEach(track => track.stop());
                    }
                    
                    // Toggle camera
                    frontCamera = !frontCamera;
                    
                    // Start new stream
                    navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: frontCamera ? 'user' : 'environment' } 
                    })
                    .then(function(stream) {
                        cameraVideo.srcObject = stream;
                        cameraVideo.play();
                        
                        // Show toast
                        showToast(`Switched to ${frontCamera ? 'front' : 'rear'} camera`, 'info');
                    })
                    .catch(function(error) {
                        console.error('Error switching camera:', error);
                        showToast('Failed to switch camera', 'error');
                    });
                });
            }
            
            // Checkout button
            const checkoutBtn = document.getElementById('checkoutBtn');
            const checkoutModal = document.getElementById('checkoutModal');
            const cancelCheckoutBtn = document.getElementById('cancelCheckoutBtn');
            
            if (checkoutBtn && checkoutModal) {
                checkoutBtn.addEventListener('click', function() {
                    // Show checkout modal
                    checkoutModal.classList.remove('hidden');
                    
                    // Set checkout total
                    const totalElement = document.getElementById('total');
                    const checkoutTotalElement = document.getElementById('checkoutTotal');
                    if (totalElement && checkoutTotalElement) {
                        checkoutTotalElement.textContent = totalElement.textContent;
                    }
                });
            }
            
            if (cancelCheckoutBtn && checkoutModal) {
                cancelCheckoutBtn.addEventListener('click', function() {
                    // Hide checkout modal
                    checkoutModal.classList.add('hidden');
                });
            }
            
            // Payment method buttons
            const paymentMethodBtns = document.querySelectorAll('.payment-method-btn');
            
            paymentMethodBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    paymentMethodBtns.forEach(b => {
                        b.classList.remove('btn-primary');
                        b.classList.add('btn-outline');
                    });
                    
                    // Add active class to clicked button
                    this.classList.remove('btn-outline');
                    this.classList.add('btn-primary');
                    
                    // Show/hide payment forms based on selected method
                    const method = this.getAttribute('data-method');
                    const cashPaymentForm = document.getElementById('cashPaymentForm');
                    
                    if (cashPaymentForm) {
                        cashPaymentForm.style.display = method === 'cash' ? 'block' : 'none';
                    }
                });
            });
            
            // Amount tendered input
            const amountTenderedInput = document.getElementById('amountTendered');
            const changeAmountElement = document.getElementById('changeAmount');
            
            if (amountTenderedInput && changeAmountElement) {
                amountTenderedInput.addEventListener('input', function() {
                    const amountTendered = parseFloat(this.value) || 0;
                    const totalElement = document.getElementById('checkoutTotal');
                    
                    if (totalElement) {
                        const total = parseFloat(totalElement.textContent.replace(/[^0-9.-]+/g, '')) || 0;
                        const change = amountTendered - total;
                        
                        changeAmountElement.textContent = formatCurrency(Math.max(0, change));
                    }
                });
            }
            
            // Complete payment button
            const completePaymentBtn = document.getElementById('completePaymentBtn');
            const paymentCompleteModal = document.getElementById('paymentCompleteModal');
            
            if (completePaymentBtn && checkoutModal && paymentCompleteModal) {
                completePaymentBtn.addEventListener('click', function() {
                    // Hide checkout modal
                    checkoutModal.classList.add('hidden');
                    
                    // Show payment complete modal
                    paymentCompleteModal.classList.remove('hidden');
                });
            }
            
            // New sale button
            const newSaleBtn = document.getElementById('newSaleBtn');
            
            if (newSaleBtn && paymentCompleteModal) {
                newSaleBtn.addEventListener('click', function() {
                    // Hide payment complete modal
                    paymentCompleteModal.classList.add('hidden');
                    
                    // Clear cart
                    const receiptItems = document.getElementById('receiptItems');
                    if (receiptItems) {
                        receiptItems.innerHTML = `
                            <div class="text-center py-8 text-secondary">
                                <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                                <p>No items in cart</p>
                            </div>
                        `;
                    }
                    
                    // Reset totals
                    const subtotalElement = document.getElementById('subtotal');
                    const taxElement = document.getElementById('tax');
                    const discountElement = document.getElementById('discount');
                    const totalElement = document.getElementById('total');
                    
                    if (subtotalElement) subtotalElement.textContent = '$0.00';
                    if (taxElement) taxElement.textContent = '$0.00';
                    if (discountElement) discountElement.textContent = '$0.00';
                    if (totalElement) totalElement.textContent = '$0.00';
                    
                    // Increment receipt number
                    const receiptNumberElement = document.getElementById('receiptNumber');
                    if (receiptNumberElement) {
                        const currentNumber = parseInt(receiptNumberElement.textContent);
                        receiptNumberElement.textContent = (currentNumber + 1).toString();
                    }
                    
                    // Show toast
                    showToast('New sale started', 'success');
                });
            }
            
            // Print receipt button
            const printReceiptBtn = document.getElementById('printReceiptBtn');
            
            if (printReceiptBtn) {
                printReceiptBtn.addEventListener('click', function() {
                    // Show toast
                    showToast('Receipt printed', 'success');
                });
            }
            
            // Clear cart button
            const clearCartBtn = document.getElementById('clearCartBtn');
            
            if (clearCartBtn) {
                clearCartBtn.addEventListener('click', function() {
                    // Confirm clear
                    if (confirm('Are you sure you want to clear the cart?')) {
                        // Clear cart
                        const receiptItems = document.getElementById('receiptItems');
                        if (receiptItems) {
                            receiptItems.innerHTML = `
                                <div class="text-center py-8 text-secondary">
                                    <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                                    <p>No items in cart</p>
                                </div>
                            `;
                        }
                        
                        // Reset totals
                        const subtotalElement = document.getElementById('subtotal');
                        const taxElement = document.getElementById('tax');
                        const discountElement = document.getElementById('discount');
                        const totalElement = document.getElementById('total');
                        
                        if (subtotalElement) subtotalElement.textContent = '$0.00';
                        if (taxElement) taxElement.textContent = '$0.00';
                        if (discountElement) discountElement.textContent = '$0.00';
                        if (totalElement) totalElement.textContent = '$0.00';
                        
                        // Show toast
                        showToast('Cart cleared', 'info');
                    }
                });
            }
            
            // Helper functions
            function simulateRecognition() {
                // Show loading
                const resultsContent = document.getElementById('resultsContent');
                if (resultsContent) {
                    resultsContent.innerHTML = `
                        <div class="flex justify-center items-center py-4">
                            <div class="spinner mr-3"></div>
                            <span>Processing image...</span>
                        </div>
                    `;
                }
                
                // Simulate processing delay
                setTimeout(function() {
                    // Randomly decide if products are recognized
                    const recognized = Math.random() > 0.3;
                    
                    if (recognized) {
                        // Randomly select 1-2 products
                        const products = [
                            { id: 1, name: 'Cola Drink 330ml', price: 1.99, confidence: 0.92 },
                            { id: 2, name: 'Potato Chips 150g', price: 2.49, confidence: 0.87 },
                            { id: 3, name: 'Chocolate Bar 100g', price: 1.79, confidence: 0.95 }
                        ];
                        
                        const count = Math.floor(Math.random() * 2) + 1;
                        const shuffled = [...products].sort(() => 0.5 - Math.random());
                        const selected = shuffled.slice(0, count);
                        
                        // Update results
                        if (resultsContent) {
                            resultsContent.innerHTML = `
                                <div class="space-y-2">
                                    ${selected.map(product => `
                                        <div class="flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-800 rounded">
                                            <div>
                                                <div class="font-medium">${product.name}</div>
                                                <div class="text-sm text-secondary">Confidence: ${Math.round(product.confidence * 100)}%</div>
                                            </div>
                                            <div class="flex items-center">
                                                <span class="mr-2">$${product.price.toFixed(2)}</span>
                                                <button class="add-to-cart-btn btn-primary p-1 rounded-md" data-product-id="${product.id}" aria-label="Add to cart">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            
                            // Add event listeners to add-to-cart buttons
                            const addToCartBtns = resultsContent.querySelectorAll('.add-to-cart-btn');
                            addToCartBtns.forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const productId = parseInt(this.getAttribute('data-product-id'));
                                    const product = products.find(p => p.id === productId);
                                    
                                    if (product) {
                                        addToCart(product);
                                    }
                                });
                            });
                        }
                        
                        // Draw bounding boxes on canvas
                        const context = cameraCanvas.getContext('2d');
                        selected.forEach((product, index) => {
                            // Generate random position for bounding box
                            const x = 0.1 + (index * 0.3);
                            const y = 0.2 + (index * 0.1);
                            const width = 0.2;
                            const height = 0.3;
                            
                            // Draw bounding box
                            context.strokeStyle = 'rgba(0, 255, 0, 0.8)';
                            context.lineWidth = 3;
                            context.strokeRect(
                                x * cameraCanvas.width,
                                y * cameraCanvas.height,
                                width * cameraCanvas.width,
                                height * cameraCanvas.height
                            );
                            
                            // Draw label
                            context.fillStyle = 'rgba(0, 255, 0, 0.8)';
                            context.font = '16px Arial';
                            context.fillText(
                                `${product.name} (${Math.round(product.confidence * 100)}%)`,
                                x * cameraCanvas.width,
                                y * cameraCanvas.height - 5
                            );
                        });
                        
                        // Show toast
                        showToast(`Recognized ${selected.length} product(s)`, 'success');
                    } else {
                        // No products recognized
                        if (resultsContent) {
                            resultsContent.innerHTML = `
                                <p class="text-center py-4">No products recognized</p>
                            `;
                        }
                        
                        // Show toast
                        showToast('No products recognized', 'warning');
                    }
                }, 1500);
            }
            
            function addToCart(product) {
                const receiptItems = document.getElementById('receiptItems');
                
                if (!receiptItems) return;
                
                // Check if cart is empty
                if (receiptItems.querySelector('.text-center')) {
                    receiptItems.innerHTML = '';
                }
                
                // Check if product is already in cart
                const existingItem = receiptItems.querySelector(`[data-product-id="${product.id}"]`);
                
                if (existingItem) {
                    // Update quantity
                    const quantityElement = existingItem.querySelector('.item-quantity');
                    const totalElement = existingItem.querySelector('.item-total');
                    
                    if (quantityElement && totalElement) {
                        const currentQuantity = parseInt(quantityElement.textContent);
                        const newQuantity = currentQuantity + 1;
                        
                        quantityElement.textContent = newQuantity;
                        totalElement.textContent = `$${(product.price * newQuantity).toFixed(2)}`;
                    }
                } else {
                    // Add new item
                    const itemElement = document.createElement('div');
                    itemElement.className = 'receipt-item p-3';
                    itemElement.setAttribute('data-product-id', product.id);
                    
                    itemElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-medium text-color">${product.name}</h4>
                                <p class="text-sm text-secondary">$${product.price.toFixed(2)}  <span class="item-quantity">1</span></p>
                            </div>
                            <span class="font-medium text-color item-total">$${product.price.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-end gap-2 mt-2">
                            <button class="text-secondary hover:text-gray-600 dark:hover:text-gray-300 decrease-quantity-btn" aria-label="Decrease quantity">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button class="text-secondary hover:text-gray-600 dark:hover:text-gray-300 increase-quantity-btn" aria-label="Increase quantity">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700 ml-2 remove-item-btn" aria-label="Remove item">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    receiptItems.appendChild(itemElement);
                    
                    // Add event listeners
                    const decreaseBtn = itemElement.querySelector('.decrease-quantity-btn');
                    const increaseBtn = itemElement.querySelector('.increase-quantity-btn');
                    const removeBtn = itemElement.querySelector('.remove-item-btn');
                    
                    if (decreaseBtn) {
                        decreaseBtn.addEventListener('click', function() {
                            const quantityElement = itemElement.querySelector('.item-quantity');
                            const totalElement = itemElement.querySelector('.item-total');
                            
                            if (quantityElement && totalElement) {
                                const currentQuantity = parseInt(quantityElement.textContent);
                                
                                if (currentQuantity > 1) {
                                    const newQuantity = currentQuantity - 1;
                                    quantityElement.textContent = newQuantity;
                                    totalElement.textContent = `$${(product.price * newQuantity).toFixed(2)}`;
                                    updateCartTotals();
                                } else {
                                    // Remove item if quantity would be 0
                                    itemElement.remove();
                                    
                                    // Check if cart is empty
                                    if (receiptItems.children.length === 0) {
                                        receiptItems.innerHTML = `
                                            <div class="text-center py-8 text-secondary">
                                                <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                                                <p>No items in cart</p>
                                            </div>
                                        `;
                                    }
                                    
                                    updateCartTotals();
                                }
                            }
                        });
                    }
                    
                    if (increaseBtn) {
                        increaseBtn.addEventListener('click', function() {
                            const quantityElement = itemElement.querySelector('.item-quantity');
                            const totalElement = itemElement.querySelector('.item-total');
                            
                            if (quantityElement && totalElement) {
                                const currentQuantity = parseInt(quantityElement.textContent);
                                const newQuantity = currentQuantity + 1;
                                
                                quantityElement.textContent = newQuantity;
                                totalElement.textContent = `$${(product.price * newQuantity).toFixed(2)}`;
                                updateCartTotals();
                            }
                        });
                    }
                    
                    if (removeBtn) {
                        removeBtn.addEventListener('click', function() {
                            itemElement.remove();
                            
                            // Check if cart is empty
                            if (receiptItems.children.length === 0) {
                                receiptItems.innerHTML = `
                                    <div class="text-center py-8 text-secondary">
                                        <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                                        <p>No items in cart</p>
                                    </div>
                                `;
                            }
                            
                            updateCartTotals();
                        });
                    }
                }
                
                // Update cart totals
                updateCartTotals();
                
                // Show toast
                showToast(`${product.name} added to cart`, 'success');
            }
            
            function updateCartTotals() {
                const receiptItems = document.getElementById('receiptItems');
                const subtotalElement = document.getElementById('subtotal');
                const taxElement = document.getElementById('tax');
                const discountElement = document.getElementById('discount');
                const totalElement = document.getElementById('total');
                
                if (!receiptItems || !subtotalElement || !taxElement || !discountElement || !totalElement) return;
                
                // Check if cart is empty
                if (receiptItems.querySelector('.text-center')) {
                    subtotalElement.textContent = '$0.00';
                    taxElement.textContent = '$0.00';
                    discountElement.textContent = '$0.00';
                    totalElement.textContent = '$0.00';
                    return;
                }
                
                // Calculate subtotal
                let subtotal = 0;
                const itemTotals = receiptItems.querySelectorAll('.item-total');
                
                itemTotals.forEach(item => {
                    subtotal += parseFloat(item.textContent.replace(/[^0-9.-]+/g, '')) || 0;
                });
                
                // Calculate tax (assume 7.5%)
                const taxRate = 0.075;
                const tax = subtotal * taxRate;
                
                // Get discount (assume 0 for now)
                const discount = parseFloat(discountElement.textContent.replace(/[^0-9.-]+/g, '')) || 0;
                
                // Calculate total
                const total = subtotal + tax - discount;
                
                // Update elements
                subtotalElement.textContent = formatCurrency(subtotal);
                taxElement.textContent = formatCurrency(tax);
                totalElement.textContent = formatCurrency(total);
            }
            
            function formatCurrency(amount) {
                return '$' + amount.toFixed(2);
            }
            
            function showToast(message, type = 'info', duration = 3000) {
                // Create toast container if it doesn't exist
                let toastContainer = document.getElementById('toast-container');
                if (!toastContainer) {
                    toastContainer = document.createElement('div');
                    toastContainer.id = 'toast-container';
                    toastContainer.className = 'fixed top-4 right-4 z-50 flex flex-col gap-2';
                    document.body.appendChild(toastContainer);
                }
                
                // Create toast element
                const toastId = 'toast_' + Date.now();
                const toastElement = document.createElement('div');
                toastElement.id = toastId;
                toastElement.className = `toast toast-${type} p-4 rounded shadow-lg flex items-center justify-between transition-all duration-300 transform translate-x-full opacity-0`;
                
                // Add appropriate background color based on type
                switch (type) {
                    case 'success':
                        toastElement.classList.add('bg-green-500', 'text-white');
                        break;
                    case 'warning':
                        toastElement.classList.add('bg-yellow-500', 'text-white');
                        break;
                    case 'error':
                        toastElement.classList.add('bg-red-500', 'text-white');
                        break;
                    default:
                        toastElement.classList.add('bg-blue-500', 'text-white');
                }
                
                // Add content
                toastElement.innerHTML = `
                    <div class="mr-2">${message}</div>
                    <button class="text-white hover:text-gray-200" aria-label="Close">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
                
                // Add to container
                toastContainer.appendChild(toastElement);
                
                // Add close event listener
                const closeButton = toastElement.querySelector('button');
                closeButton.addEventListener('click', () => {
                    hideToast(toastId);
                });
                
                // Show toast with animation
                setTimeout(() => {
                    toastElement.classList.remove('translate-x-full', 'opacity-0');
                }, 10);
                
                // Auto-hide after duration
                setTimeout(() => {
                    hideToast(toastId);
                }, duration);
            }
            
            function hideToast(id) {
                const toastElement = document.getElementById(id);
                if (toastElement) {
                    toastElement.classList.add('translate-x-full', 'opacity-0');
                    
                    // Remove element after animation
                    setTimeout(() => {
                        toastElement.remove();
                    }, 300);
                }
            }
        });
    </script>
</body>
</html>
